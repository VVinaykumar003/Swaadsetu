{
  "info": {
    "_postman_id": "swad-setu-full-automated-2025",
    "name": "Swad Setu - Full API Collection (Automated)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Complete, automated Postman collection for Swad Setu backend. Structured URLs, token capture, ID capture, and basic tests."
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost:5000" },
    { "key": "rid", "value": "restro10" },
    { "key": "token", "value": "" },
    { "key": "staff_token", "value": "" },
    { "key": "table_id", "value": "" },
    { "key": "order_id", "value": "" },
    { "key": "bill_id", "value": "" },
    { "key": "call_id", "value": "" },
    { "key": "menu_item_id", "value": "" }
  ],
  "item": [
    {
      "name": "Admin",
      "item": [
        {
          "name": "Admin Login (get JWT)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"pin\": \"1111\"\n}" },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/login",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200/201', function () { pm.expect(pm.response.code).to.be.oneOf([200,201]); });",
                  "console.log('--- Admin Login response ---');",
                  "console.log(pm.response.text());",
                  "try {",
                  "  const json = pm.response.json();",
                  "  console.log('Parsed JSON:', json);",
                  "  const token = (json && json.token) || (json && json.data && json.data.token) || (json && json.result && json.result.token) || (json && json.access && json.access.token) || null;",
                  "  pm.test('token exists', function () { pm.expect(token, 'token not found in response').to.not.be.null; });",
                  "  if (token) {",
                  "    try { pm.environment.set('token', token); } catch (e) { console.warn('env set failed', e); }",
                  "    try { pm.globals.set('token', token); } catch (e) { console.warn('globals set failed', e); }",
                  "    pm.test('token saved to env & globals', function () { pm.expect(pm.environment.get('token') || pm.globals.get('token')).to.eql(token); });",
                  "    console.log('Saved token:', token);",
                  "  }",
                  "} catch (err) {",
                  "  console.error('Error parsing login response or saving token:', err);",
                  "  pm.test('login parse error', function () { pm.expect.fail('Exception while parsing response'); });",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Staff Login (get JWT)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"pin\": \"1111\"\n}" },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/auth/staff-login",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "auth", "staff-login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200/201', function () { pm.expect(pm.response.code).to.be.oneOf([200,201]); });",
                  "console.log('--- Staff Login response ---');",
                  "console.log(pm.response.text());",
                  "try {",
                  "  const json = pm.response.json();",
                  "  console.log('Parsed JSON:', json);",
                  "  const token = (json && json.token) || (json && json.data && json.data.token) || (json && json.result && json.result.token) || (json && json.access && json.access.token) || null;",
                  "  pm.test('staff token exists', function () { pm.expect(token, 'token not found in response').to.not.be.null; });",
                  "  if (token) {",
                  "    try { pm.environment.set('staff_token', token); } catch (e) { console.warn('env set failed', e); }",
                  "    try { pm.globals.set('staff_token', token); } catch (e) { console.warn('globals set failed', e); }",
                  "    pm.test('staff token saved to env & globals', function () { pm.expect(pm.environment.get('staff_token') || pm.globals.get('staff_token')).to.eql(token); });",
                  "    console.log('Saved staff token:', token);",
                  "  }",
                  "} catch (err) {",
                  "  console.error('Error parsing staff login response or saving token:', err);",
                  "  pm.test('staff login parse error', function () { pm.expect.fail('Exception while parsing response'); });",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get public Menu",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/menu",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "menu"]
            }
          }
        },
        {
          "name": "Create/Update Menu (protected)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"menu\": [\n    { \"itemId\": \"m1\", \"name\": \"Paneer Butter Masala\", \"price\": 250 },\n    { \"itemId\": \"m2\", \"name\": \"Gulab Jamun\", \"price\": 80 }\n  ],\n  \"categories\": [\n    { \"name\": \"Main Course\", \"itemIds\": [\"m1\"] },\n    { \"name\": \"Desserts\", \"itemIds\": [\"m2\"] }\n  ],\n  \"taxes\": [{ \"name\": \"GST\", \"percent\": 5 }],\n  \"serviceCharge\": 10,\n  \"branding\": { \"title\": \"Swad Setu\" }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/menu",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "menu"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('menu update status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "console.log('Menu update response:', pm.response.text());"
                ]
              }
            }
          ]
        },
        {
          "name": "Add Menu Item (protected)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"item\": {\n    \"itemId\": \"m3\",\n    \"name\": \"Paneer Tikka\",\n    \"price\": 299,\n    \"description\": \"Grilled cottage cheese with spices\",\n    \"category\": \"Appetizers\",\n    \"image\": \"https://example.com/paneer-tikka.jpg\",\n    \"isVegetarian\": true,\n    \"preparationTime\": 20\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/menu/items",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "menu", "items"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('add menu item status 201 or 200', function () { pm.expect(pm.response.code).to.be.oneOf([200,201]); });",
                  "console.log('Add menu item response:', pm.response.text());",
                  "try {",
                  "  const json = pm.response.json();",
                  "  // item may be returned as body itself or nested",
                  "  const item = (json && json.item) || json || null;",
                  "  if (item) {",
                  "    const id = item.itemId || item.id || item._id || null;",
                  "    if (id) { pm.environment.set('menu_item_id', id); pm.globals.set('menu_item_id', id); pm.test('menu_item_id saved', () => true); console.log('Saved menu_item_id:', id); }",
                  "  }",
                  "} catch (e) { console.warn('could not parse add menu item response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Generate Override Token (PIN)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"pin\": \"1111\"\n}" },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/overrides",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "overrides"]
            }
          }
        },
        {
          "name": "Get Analytics (protected)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/analytics?period=daily",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "analytics"],
              "query": [{ "key": "period", "value": "daily" }]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('analytics status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "console.log('Analytics response:', pm.response.text());",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('analytics keys present', function () {",
                  "    pm.expect(json).to.have.property('period');",
                  "    pm.expect(json).to.have.property('totalRevenue');",
                  "    pm.expect(json).to.have.property('orderCount');",
                  "    pm.expect(json).to.have.property('topItems');",
                  "    pm.expect(json).to.have.property('peakHours');",
                  "    pm.expect(json).to.have.property('unpaidBills');",
                  "    pm.expect(json).to.have.property('voidedBills');",
                  "  });",
                  "} catch (e) { console.warn('could not parse analytics response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Export Report (protected)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"format\": \"csv\", \"period\": \"monthly\" }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/export",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "export"]
            }
          }
        },
        {
          "name": "Admin: Update Table Config (protected)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"capacity\": 6, \"isActive\": true }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/tables/{{table_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "tables", "{{table_id}}"],
              "variable": [{ "key": "table_id", "value": "{{table_id}}" }]
            }
          }
        },
        {
          "name": "Admin: Update PIN (protected)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"currentPin\": \"1111\", \"newPin\": \"2222\" }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/pin",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "pin"]
            }
          }
        },
        {
          "name": "Admin: Update Staff Aliases (protected)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"staffAliases\": [\"Manager\",\"Waiter\",\"Chef\"] }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/staff-aliases",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "staff-aliases"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('staffAliases present', function () {",
                  "    pm.expect(json).to.have.property('staffAliases');",
                  "  });",
                  "} catch (e) { console.warn('could not parse staff aliases response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Admin: Update Config (protected)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"taxPercent\": 5, \"globalDiscountPercent\": 10, \"serviceCharge\": 15 }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/config",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "config"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('config updated', function () {",
                  "    pm.expect(json).to.have.property('settings');",
                  "  });",
                  "} catch (e) { console.warn('could not parse config response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Admin: Create Table (protected)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"tableNumber\": 5, \"capacity\": 4, \"isActive\": true }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('create table 200/201', function () { pm.expect(pm.response.code).to.be.oneOf([200,201]); });",
                  "try { const json = pm.response.json(); const id = json && (json._id || json.id || json.tableId); if (id) { pm.environment.set('table_id', id); pm.globals.set('table_id', id); console.log('Saved table_id:', id); } } catch (e) { console.warn('Could not parse create table response', e); }"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "User",
      "item": [
        {
          "name": "User: GET Menu (public)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/menu",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "menu"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('menu status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('menu keys present', function () {",
                  "    pm.expect(json).to.have.property('menu');",
                  "    pm.expect(json).to.have.property('categories');",
                  "    pm.expect(json).to.have.property('taxes');",
                  "    pm.expect(json).to.have.property('serviceCharge');",
                  "    pm.expect(json).to.have.property('branding');",
                  "  });",
                  "} catch (e) { console.warn('could not parse menu response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "User: POST Order (with customerName)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tableId\": \"{{table_id}}\",\n  \"sessionId\": \"sess_abc\",\n  \"customerName\": \"John Doe\",\n  \"items\": [ { \"itemId\": \"m1\", \"name\": \"Paneer Butter Masala\", \"price\": 250, \"quantity\": 1 } ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "orders"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('create order status 201/200', function () { pm.expect(pm.response.code).to.be.oneOf([200,201]); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('order keys present', function () {",
                  "    pm.expect(json).to.have.property('order');",
                  "    pm.expect(json).to.have.property('preBill');",
                  "  });",
                  "  const id = json && json.order && (json.order._id || json.order.id || json.order.orderId);",
                  "  if (id) { pm.environment.set('order_id', id); pm.globals.set('order_id', id); console.log('Saved order_id:', id); }",
                  "} catch (e) { console.warn('Could not parse create order response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "User: GET Order History",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/orders/history?sessionId=sess_abc",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "orders", "history"],
              "query": [{ "key": "sessionId", "value": "sess_abc" }]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('order history status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('order history is array', function () {",
                  "    pm.expect(json).to.be.an('array');",
                  "  });",
                  "} catch (e) { console.warn('could not parse order history response', e); }"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Staff",
      "item": [
        {
          "name": "Staff: GET Active Orders",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/orders/active",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "orders", "active"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('active orders status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('active orders is array', function () {",
                  "    pm.expect(json).to.be.an('array');",
                  "  });",
                  "} catch (e) { console.warn('could not parse active orders response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Staff: PATCH Order Status",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"status\": \"preparing\", \"version\": 1 }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/orders/{{order_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "orders", "{{order_id}}", "status"],
              "variable": [{ "key": "order_id", "value": "{{order_id}}" }]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('update order status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('order status updated', function () {",
                  "    pm.expect(json).to.have.property('status', 'preparing');",
                  "  });",
                  "} catch (e) { console.warn('could not parse update order status response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Staff: Create Draft Bill",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tableId\": \"{{table_id}}\",\n  \"sessionId\": \"sess_abc\",\n  \"staffAlias\": \"Waiter\",\n  \"items\": [ { \"name\": \"Paneer Butter Masala\", \"priceAtOrder\": 250, \"quantity\": 1 } ],\n  \"extras\": []\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/bills",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "bills"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('create bill status 201/200', function () { pm.expect(pm.response.code).to.be.oneOf([200,201]); });",
                  "try { const json = pm.response.json(); const id = json && (json._id || json.id || json.billId); if (id) { pm.environment.set('bill_id', id); pm.globals.set('bill_id', id); console.log('Saved bill_id:', id); } } catch (e) { console.warn('Could not parse create bill response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Staff: Edit Draft Bill",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [ { \"name\": \"Paneer Butter Masala\", \"priceAtOrder\": 250, \"quantity\": 1 }, { \"name\": \"Gulab Jamun\", \"priceAtOrder\": 80, \"quantity\": 2 } ],\n  \"staffAlias\": \"Waiter\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/bills/{{bill_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "bills", "{{bill_id}}"],
              "variable": [{ "key": "bill_id", "value": "{{bill_id}}" }]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('update bill status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('bill updated', function () {",
                  "    pm.expect(json).to.have.property('status', 'draft');",
                  "  });",
                  "} catch (e) { console.warn('could not parse update bill response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Staff: Finalize Bill",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"staffAlias\": \"Waiter\" }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/bills/{{bill_id}}/finalize",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "bills", "{{bill_id}}", "finalize"],
              "variable": [{ "key": "bill_id", "value": "{{bill_id}}" }]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('finalize bill status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('bill finalized', function () {",
                  "    pm.expect(json).to.have.property('status', 'finalized');",
                  "  });",
                  "} catch (e) { console.warn('could not parse finalize bill response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Staff: Mark Bill Paid",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"staffAlias\": \"Waiter\", \"paymentNote\": \"Cash payment\" }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/bills/{{bill_id}}/mark-paid",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "bills", "{{bill_id}}", "mark-paid"],
              "variable": [{ "key": "bill_id", "value": "{{bill_id}}" }]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('mark bill paid status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('bill marked paid', function () {",
                  "    pm.expect(json).to.have.property('paymentStatus', 'paid');",
                  "  });",
                  "} catch (e) { console.warn('could not parse mark bill paid response', e); }"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Analytics",
      "item": [
        {
          "name": "Analytics: GET Analytics",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/admin/analytics?period=daily",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "admin", "analytics"],
              "query": [{ "key": "period", "value": "daily" }]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('analytics status 200', function () { pm.expect(pm.response.code).to.eql(200); });",
                  "try {",
                  "  const json = pm.response.json();",
                  "  pm.test('analytics keys present', function () {",
                  "    pm.expect(json).to.have.property('period');",
                  "    pm.expect(json).to.have.property('totalRevenue');",
                  "    pm.expect(json).to.have.property('orderCount');",
                  "    pm.expect(json).to.have.property('topItems');",
                  "    pm.expect(json).to.have.property('peakHours');",
                  "    pm.expect(json).to.have.property('unpaidBills');",
                  "    pm.expect(json).to.have.property('voidedBills');",
                  "  });",
                  "} catch (e) { console.warn('could not parse analytics response', e); }"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Tables",
      "item": [
        {
          "name": "Create Table (admin)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"tableNumber\": 5, \"capacity\": 4, \"isActive\": true }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('create table 200/201', function () { pm.expect(pm.response.code).to.be.oneOf([200,201]); });",
                  "try { const json = pm.response.json(); const id = json && (json._id || json.id || json.tableId); if (id) { pm.environment.set('table_id', id); pm.globals.set('table_id', id); console.log('Saved table_id:', id); } } catch (e) { console.warn('Could not parse create table response', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Tables",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables"]
            }
          }
        },
        {
          "name": "Get Table By ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables/{{table_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables", "{{table_id}}"],
              "variable": [{ "key": "table_id", "value": "{{table_id}}" }]
            }
          }
        },
        {
          "name": "Update Table Status (protected)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": { "mode": "raw", "raw": "{ \"isActive\": false }" },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables/{{table_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables", "{{table_id}}", "status"],
              "variable": [{ "key": "table_id", "value": "{{table_id}}" }]
            }
          }
        },
        {
          "name": "Assign Session to Table (protected)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"sessionId\": \"sess_abc\", \"staffAlias\": \"Waiter\" }"
            },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables/{{table_id}}/session",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables", "{{table_id}}", "session"],
              "variable": [{ "key": "table_id", "value": "{{table_id}}" }]
            }
          }
        },
        {
          "name": "Update Staff Alias for Table (protected)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{staff_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": { "mode": "raw", "raw": "{ \"staffAlias\": \"Waiter\" }" },
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables/{{table_id}}/staff",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables", "{{table_id}}", "staff"],
              "variable": [{ "key": "table_id", "value": "{{table_id}}" }]
            }
          }
        },
        {
          "name": "Delete Table (admin)",
          "request": {
            "method": "DELETE",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/tables/{{table_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "tables", "{{table_id}}"],
              "variable": [{ "key": "table_id", "value": "{{table_id}}" }]
            }
          }
        }
      ]
    },
    {
      "name": "Health & Utilities",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            }
          }
        },
        {
          "name": "Get Active Socket Rooms (debug) - optional",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{token}}" }],
            "url": {
              "raw": "{{base_url}}/api/{{rid}}/debug/sockets",
              "host": ["{{base_url}}"],
              "path": ["api", "{{rid}}", "debug", "sockets"]
            }
          }
        }
      ]
    }
  ]
}
